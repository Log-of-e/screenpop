// Filename: screenpop.full.js  
// Timestamp: 2014/01/15 (last modified)  
// Author(s): Bumblehead (www.bumblehead.com)  

var lockfnthrottling=("object"==typeof module?module:{}).exports=function(){var t={ms:500,timer:null,lastFn:null,throttledFn:function(t){var n=this;n.timer?n.lastFn=t:(n.timer=setTimeout(function(){n.lastFn&&(n.lastFn(),n.lastFn=null),clearTimeout(n.timer),n.timer=null},n.ms),t())}};return{getNew:function(n){var l=Object.create(t);return l.ms=n.ms||500,l.timer=null,l.lastFn=null,function(t){l.throttledFn(t)}}}}();var lockfnrebounding=("object"==typeof module?module:{}).exports=function(){var n={flag:!1,go:function(n){var o=this,t=o.flag;t===!1&&(o.flag=!0,n(function(){o.flag=!1}))}};return{getNew:function(){var o=Object.create(n);return o.flag=!1,function(n){o.go(n)}}}}();var lockfnqueuing=("object"==typeof module?module:{}).exports=function(){var t={isActive:!1,fnArr:[],getValArr:[],callLimit:function(){var t=this,e=t.fnArr,r=t.getValArr;!function i(n,u,c){u=r.shift(),c=e.shift(),u(function(e,n,u){c&&c(e,n,u),r.length?i(r.length):t.isActive=!1})}(r.length)},queueAdd:function(t,e){var r=this;r.fnArr.push(t),r.getValArr.push(e),r.isActive===!1&&(r.isActive=!0,r.callLimit())}};return{getNew:function(){var e=Object.create(t);return e.isActive=!1,e.fnArr=[],e.getValArr=[],function(t,r){e.queueAdd(t,r)}}}}();var lockfncaching=("object"==typeof module?module:{}).exports=function(){var c={val:void 0,isActive:!1,funcArr:[],callFuncArr:function(c,e){var n=this,r=n.funcArr;for(n.isActive=!1;r.length;)r.pop()(c,e)},cacheVal:function(c,e){var n=this,r=n.val;n.funcArr.push(c),n.isActive===!1&&(n.isActive=void 0===r,"undefined"==typeof r?e(function(c,e){return c?n.callFuncArr(c,e):void n.callFuncArr(c,n.val=e)}):n.callFuncArr(null,r))}};return{getNew:function(){var e=Object.create(c);return e.isActive=!1,e.funcArr=[],e.val=void 0,function(c,n){e.cacheVal(c,n)}},getNamespaceCache:function(){var c={};return function(e){return c[e]||(c[e]=this.getNew())}}(),getNamespaceNew:function(){var c,e=this;return function(n,r,t){(c=e.getNamespaceCache(n))(r,t)}}}}();var lockfn=("object"==typeof module?module:{}).exports=function(){return{Queuing:lockfnqueuing,Caching:lockfncaching,Rebounding:lockfnrebounding,Throttling:lockfnthrottling}}();var lsn=function(n,t,e,o){function c(n){return/^(?:function|object|unknown)$/.test(typeof n)?!0:!1}return n=document.documentElement,t=function(){},e={add:function(e){return c(n.addEventListener)?e=function(n,t,e){n.addEventListener(t,e,!1)}:c(n.addatchEvent)&&(e=function(n,t,e){n.attachEvent("on"+t,function(n){e(n||window.event)})}),e||t}(),rm:function(e){return c(n.removeEventListener)?e=function(n,t,e){n.removeEventListener(t,e,!1)}:c(n.detachEvent)&&(e=function(n,t,e){n.detachEvent("on"+t,e)}),e||t}()},o=e.add,o.rm=e.rm,o}();var domwh=function(i,n,t){return t=document,i=function(i){var n,t=[i.offsetWidth,i.offsetHeight];return t[0]||(n=i.style,"none"===n.display?(n.display="block",t=[i.offsetWidth,i.offsetHeight],n.display="none"):""===n.display&&(n.display="block",t=[i.offsetWidth,i.offsetHeight],n.display="")),t},i.window=function(){return window&&window.innerHeight?[window.innerWidth,window.innerHeight]:(n=t.documentElement)?(n=n.clientWidth?n:t.documentBody,[n.clientWidth,n.clientHeight]):null},i}();var elemst={up:function(a,e){var s,c="st-"+e,t=(e||"").match(/(\w*(?:-)|\b)(\w*)/)||[],m=t[2],n=t[1]||"";a&&m&&(s=a.className,s.match(c)||(t=new RegExp("st-("+n+"\\w*)"),a.className=s.match(t)?s.replace(t,c):s+" "+c))},rm:function(a,e){var s,c=new RegExp("[\b ]st-"+e+"(-\\w*)?");a&&(s=a.className,s.match(c)&&(a.className=s.replace(c,"")))},is:function(a,e){return a&&a.className.match("st-"+e)?!0:!1}};var screenpop=function(e,t,n){return n=function(e){"function"==typeof e&&e(null,"")},e={count:0,uid:0,hintSize:20,throttlefn:lockfn.Throttling.getNew({ms:500}),elemst:elemst,domwh:domwh,lsn:lsn,onLoadHook:n,onShutHook:n,onOpenHook:n,onRenderHook:n,onLoad:function(e){return this.onLoadHook=e,this},onShut:function(e){return this.onShutHook=e,this},onOpen:function(e){return this.onOpenHook=e,this},onRender:function(e){return this.onRenderHook=e,this},createDiv:function(e,t){var n=document.createElement("div");return"string"==typeof e&&(n.className=e,n.id=(t||"")+e),n},connect:function(){var e=this;e.lsn(document,"keydown",function(e){e&&27===e.keyCode&&t.shut()}),e.lsn(window,"resize",function(){e.throttlefn(function(){t.center()})}),e.lsn(window,"scroll",function(){e.throttlefn(function(){t.centerVert()})})},getLoadElemStr:function(){return""},getLayersElem:function(){var e=this;return document.getElementById("sp-layers")||function(t){return t=e.createDiv("sp-layers"),e.container.appendChild(t),e.connect(),t}()},createLayerElem:function(){var e=this,t=e.uid,n=e.createDiv("sp-layers-layer",t),o=e.createDiv("sp-layers-layer-screen",t),r=e.createDiv("sp-layers-layer-content",t),i=e.createDiv("sp-layers-layer-load",t);return i.innerHTML=e.getLoadElemStr(),n.appendChild(o),n.appendChild(i),n.appendChild(r),n.onclick=function(){e.shut()},n},getLayerElem:function(){return document.getElementById(this.uid+"sp-layers-layer")||this.createLayerElem()},getContentElem:function(){return document.getElementById(this.uid+"sp-layers-layer-content")},getLoadElem:function(){return document.getElementById(this.uid+"sp-layers-layer-load")},getScroll:function(){return window.pageYOffset||document.body.scrollTop},getContentT:function(){var e,t=this.getContentElem();return t&&(e=t.style.margin.match(/^\d*/),e&&(e=parseFloat(e[0]),e=isNaN(e)?null:e)),e},center:function(){var e,t,n,o,r=this,i=r.getContentElem();i&&(e=r.domwh(i),t=r.domwh.window(),n=(t[1]-e[1])/2,o=(t[0]-e[0])/2,0>n&&(n=0),i.style.margin=":tpx :rlpx 0".replace(/:t/,n+r.getScroll()).replace(/:rl/gi,o))},centerVert:function(){var e,t,n,o,r,i,c=this,a=c.getContentElem();a&&(e=c.domwh(a)[1],t=c.domwh.window()[1],i=c.getContentT(),o=c.getScroll(),n=(t-e)/2,i+e-c.hintSize<=o?r=o-e+c.hintSize:i>=o&&i>n+o&&(r=n>0?n+o:o),"number"==typeof r&&(a.style.marginTop=":tpx".replace(/:t/,r)))},replaceContent:function(e){var t=this.getContentElem();t&&("string"==typeof e?t.innerHTML=e:"object"==typeof e&&e&&"tagName"in e&&t.appendChild(e))},pop:function(e){var n,o=this,r=function(t,n){"function"==typeof e&&e(t,n)};t.shut(),t.screenobjLast=this,n=o.getLayerElem(),o.elemst.up(n,"screen-load"),o.getLayersElem().appendChild(n),o.onRenderHook(o,function(e,t){return e?r(e):(o.replaceContent(t),o.center(),void o.open())})},open:function(){var e=this;e.center(),e.elemst.up(e.getLayerElem(),"screen-show"),e.onOpenHook(e)},load:function(){var e=this;e.center(),e.elemst.up(e.getLayerElem(),"screen-load")},shut:function(){var e=this;e.elemst.up(e.getLayerElem(),"screen-hide"),e.onShutHook(e)},rm:function(){var e=this.getLayerElem();e&&e.parentNode.removeChild(e)},clear:function(){this.replaceContent("")}},t=function(t){var o=Object.create(e);return o.uid=t&&t.uid?t.uid:++e.count,o.onLoadHook=n,o.onShutHook=n,o.onOpenHook=n,o.onRenderHook=n,o.container=document.body,t&&("number"==typeof t.hintSize&&(o.hintSize=t.hintSize),"string"==typeof t.loadElemStr&&(o.getLoadElemStr=function(){return t.loadElemStr})),o},t.proto=e,t.screenobjLast=null,t.shut=function(){var e=this.screenobjLast;e&&e.shut()},t.rm=function(){var e=this.screenobjLast;e&&e.rm()},t.center=function(){var e=this.screenobjLast;e&&e.center()},t.centerVert=function(){var e=this.screenobjLast;e&&e.centerVert()},t}();